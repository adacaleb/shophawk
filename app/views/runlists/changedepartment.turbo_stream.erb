<%= turbo_stream.update "wcSelect" do %>
  <select class="form-select" data-action="change->runlist#changeWc"> <!-- data action is the js controller to run -->
    <option selected>WorkCenter</option>
    <% @workCenters.each do |w| %>
      <option ><%= w %></option>
    <% end %>
  </select>
<% end %>

<%= turbo_stream.update "editDepartmentButton" do %>
<div class="btn-group" >
    <%= link_to "New department", new_department_path, class: "btn btn btn-success" %>
    <%= link_to "Edit Department", edit_department_path(@department), data: {turbo_frame: "editdepartment"}, class: "btn btn-dark btn-small" %>
  </div>
<% end %>

<%= turbo_stream.update "newassignmentbutton" do %>
<div class="btn-group" >
  <%= link_to "New assignment", newassignment_runlists_path(:departmentid => @departmentid), data: { turbo_frame: "newassignment" }, class: "btn btn-info" %>
  <%= link_to "Show Assignments", showAssignments_runlists_path(:departmentid => @department.id, :department => @department.department), class: "btn btn-dark" %>  
</div>
<% end %> 

<%= turbo_stream.update "refresh" do %>
<div class="row">
  <div class="col-1">
    <%= link_to "Refresh", changedepartment_runlists_path(:department => @department.department), class: "btn btn-secondary" %>
  </div>
  <div class="col-4"></div>
  <div class="col">
    Data Syncs every 5 minutes from Jobboss
  </div>
  <div class="col"></div>
</div>
<% end %>

<%= turbo_stream.update "newAssignment" do %>
<% end %>
<%= turbo_stream.update "showAssignments" do %>
<% end %>


<%= turbo_stream.update "activerunlistrender" do %>
  <!--  <h4>Today is <%= @today = Date.today %> </h4> -->
  <% i = 0 %>
  <table style="table-layout:fixed" class="table table-dark table-striped table-hover align-middle table table-bordered text-center" >
    <thead>
      <tr>
        <th width="70px" scope="col">Job</th>
        <th width="40px" style="font-size: 12px" scope="col">Qty</th>
        <th width="100px" scope="col">Material</th>
        <th width="100px" scope="col">Part number</th>
        <th width="140px" scope="col">Description</th>
        <th width="100px" scope="col">Ship Date</th> 
        <th width="100px" scope="col">Customer</th> 
        <th width="125px" scope="col">Assignment</th>
        <th width="50px" style="font-size: 10px" scope="col">Material Pending</th>
        <th width="90px" style="font-size: 14px" scope="col">Operation</th>
        <th width="90px" style="font-size: 12px" scope="col">Current Location</th>
      </tr>
    </thead>
    <tbody>
      <% @previousStartDate = "1990-01-01" %> <!-- initialize startdate variable -->
      <% @operations.each do |op| %>
          <% date = op.Sched_Start.to_s %>
            <% dates = date.gsub("-", "/").to_s %> <!-- converts "-" to "/" for date strptime class -->
            <% startDate = Date.strptime(dates, "%m/%d/%Y") %> <!-- converts string to date type variable -->

            <!-- call method to calculate total hours of machinetime for this day, then display -->


            <% if @previousStartDate != startDate %> <!-- don't render another header if the date is same as previous -->
              <% if startDate.before? @today %>
                <% @rowColor = "table-danger" %>
                <tr >
                  <th colspan="2" class="table-light" style="font-size: 14px"><%= op.Sched_Start %></th>
                  <th colspan="2" class="table-light" style="font-size: 14px">~<%= dailyHoursCalc(date, @operations) %> Hours</th>
                </tr>
              <% end %>
              <% if startDate == @today %>
                <% @rowColor = "table-light" %>
                <tr >
                  <th colspan="2" class="table-light" style="font-size: 14px"><%= op.Sched_Start %></th>
                  <th colspan="2" class="table-light" style="font-size: 14px">~<%= dailyHoursCalc(date, @operations) %> Hours</th>
                </tr>
              <% end %>
              <% if startDate.after? @today %>
                <% @rowColor = "table-default" %>
                <tr>
                  <th colspan="2" class="table-light" style="font-size: 14px"><%= op.Sched_Start %></th>
                  <th colspan="2" class="table-light" style="font-size: 14px">~<%= dailyHoursCalc(date, @operations) %> Hours</th>
                </tr>
              <% end %>
              <% if op.status == "S" %>
                <% @rowColor = "table-info" %>
              <% end %>
            <% end %>

            <% @previousStartDate = startDate %>
            <tr class="<%= @rowColor %>" >
             <%= render op %>
            </tr>
          <% i = i + 1 %>
          <% if i == 1000 %>
            <% break %>
          <% end %>

      <% end %>
    </tbody>
  </table>
<% end %>